<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>work</title>																	<!--Update-->
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="index,follow">						<!--Update-->
    <!-- CSS files-->
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="css/fontastic.css">
    <!-- Google fonts - Poppins -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
    <!-- Theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
        
    <!-- Mine files-->													<!--Update-->
		<script src="js/mine/axios.min.js"></script>					<!--Update-->
  	<script src="js/mine/lodash.js"></script>							<!--Update-->
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
  	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>		
    
    <!-- JavaScript files-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>   
    <!-- Main JavaScript File-->
    <script src="js/front.js"></script>      
    
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  </head>

  <body>
    <div class="page" id="app">				<!-- 布局：page->(<header>)->(<nav>)->container->navbar-holder->navbar-header  -->
      <!-- Main Navbar-->
      <header class="header">		<!--Update: <header>标签定义文档的页眉(介绍信息)。  -->
        <nav class="navbar">		<!--Update: <nav> 标签定义导航链接的部分。  -->
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <!-- Navbar Header-->
              <div class="navbar-header">
                <!-- Navbar Brand -->
                	<a href="index.html" class="navbar-brand d-none d-sm-inline-block">
                  		<div class="brand-text d-none d-lg-inline-block"><span>Spring<strong>&nbsp;春天造型</strong></span></div>
                  		<div class="brand-text d-none d-sm-inline-block d-lg-none"><strong>BD</strong></div>		<!--Update：收藏网站时显示在前面的图标。-->
                	</a>
                <!-- Toggle Button-->
                	<a id="toggle-btn" href="#" class="menu-btn active"><span></span><span></span><span></span></a>
              </div>
              <!-- Navbar Menu -->
              <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                <!-- Logout    -->
                <li class="nav-item"><a href="login.html" class="nav-link logout"> <span class="d-none d-sm-inline">退出系统</span><i class="fa fa-sign-out"></i></a></li>
              </ul>
            </div>
          </div>
        </nav>
      </header>
      
			<div class="page-content d-flex align-items-stretch">  	
        <!-- Side Navbar -->
        <nav class="side-navbar">
          <!-- Sidebar Header-->
          <div class="sidebar-header d-flex align-items-center">
            <div class="avatar"><img src="img/holder.jpg" alt="..." class="img-fluid rounded-circle"></div>
            <div class="title">
              <h1 class="h1">店长&nbsp;&nbsp;阿明</h1>
              <p>store manager</p>
            </div>
          </div>
          <!-- Sidebar Navidation Menus-->
          <span class="heading">功能模块</span>
          <ul class="list-unstyled">
            <li class="active"><a href="#" @click="select_one()"><i class="icon-home"></i>工作模块</a></li>
            <li><a href="#exampledropdownDropdown" aria-expanded="false" data-toggle="collapse"><i class="icon-user"></i>信息管理</a>		
            		<!--Update: aria-expaned属性表示展开状态。默认为undefined,表示当前展开状态未知；true表示元素是展开的；false表示元素不是展开的。-->
              <ul id="exampledropdownDropdown" class="collapse list-unstyled ">
                <li><a href="#" @click="select_two()">会员卡</a></li>
                <li><a href="#" @click="select_three()">客户</a></li>
                <li><a href="#" @click="select_four()">照片</a></li>
              </ul>
            </li>
            <li><a href="#" @click="select_five()"><i class="icon-page"></i>营业统计</a></li>
            <li><a href="#" @click="select_six()"><i class="icon-screen"></i>系统设置</a></li>
          </ul>            
        </nav>
      
      	<!-- Page -->
        <div class="content-inner">			<!-- 布局：page-content->content-inner->page-header  -->
          <!-- Page Header-->
          <header class="page-header">
            <div class="container-fluid">
              <h1 class="no-margin-bottom">客户信息</h1>
            </div>
          </header>
                   
        <!-- Works Section-->
        <section class="forms ">
          <div class="container-fluid" id="app">
            <div draggable="true" class="row " >
                <div class="col-lg-5">
                  <div class="card">
                    <div class="card-header d-flex align-items-center">
                    <h3 class="h4">账户信息</h3>
                    </div>
                    <div class="card-body">
                    <form>
                      <div class="form-group row">
                        <div class="col-sm-12">
                        <label class="form-control-label">卡号：</label>
                        <el-input
                                style="width:60%"
                                placeholder="请输入卡号或电话号"
                                prefix-icon="el-icon-search"
                                v-model="cardCode"
                                clearable>
                        </el-input>
                          <el-button @click="check()">查询</el-button>
                        </div>
                      </div>
                      <div class="form-group row">
                        <div class="col-sm-12">
                          <div class="row">
                              <div class="col-md-6">
                                <label class="form-control-label" >余额：</label>
                                <div>
                                  <el-input
                                          style="width:40%"
                                          :disabled="true"
                                          v-model="card.cardMoney">
                                  </el-input>

                                    <el-button :loading="load" @click="recharge()">充值</el-button>


                                  <el-input v-model="rechargePrice">充值金额</el-input>


                                </div>
                                </div>

                                  <div class="col-md-6">
                                     <label class="form-control-label">积分：</label>
                                      <div>
                                        <el-input
                                                style="width:40%"
                                                :disabled="true"
                                                v-model="card.cardPoint">
                                        </el-input>
                                        <el-button :loading="load" @click="drawings1()">提现</el-button>

                                        <el-input v-model="drawingsPrice">充值金额</el-input>


                                      </div>
                                  </div>
                              </div>
                             </div>
                          </div>



                          <label class="form-control-label" v-if="clients.length!='0'">用户列表：</label>
                          <el-select v-model="xuanze.name" :disabled="load" v-if="clients.length!='0'">
                            <el-option
                                    v-for="client in clients"
                                    :key="client.client_id"
                                    :value="client.client_name"
                                    >
                              <a @click="bangding(client.client_id,client.client_name)" style="width:100%">{{client.client_name}}</a>
                            </el-option>
                          </el-select>


                          <!--<el-button>添加用户</el-button> -->

                          <div class="daily-feeds card" v-if="clients.length!='0'">
                            <div class="card-body no-padding">
                              <!-- 头像列表-->
                                <div class="item"  v-for="client in clients">

                                  <div class="feed d-flex justify-content-between">
                                    <div class="feed-body d-flex justify-content-between">
                                      <input name="info" type="radio" :value="client.client_id" v-model="xuanze.id" @click="bangding(client.client_id,client.client_name)"/>
                                      <a href="#" class="feed-profile"><img src="img/avatar-5.jpg" alt="person" class="img-fluid rounded-circle"></a>
                                      <div class="content">
                                        <h5>姓名：{{client.client_name}}</h5><span>性别：{{client.client_gender}} </span>
                                        <div class="full-date">电话：{{client.client_phone}} </div>
                                      </div>
                                    </div>
                                    <div >
                                      <el-button @click="deleteclient(client)"><h5>删除</h5></el-button>
                                    </div>
                                  </div>
                                </div>
                                </lable>
                            </div>
                          </div>
                      </form>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header d-flex align-items-center">
                      <h3 class="h4">消费项目</h3>
                    </div>
                    <div class="card-body">
                      <form class="form-horizontal">
                        <div class="form-group row">
                          <table>
                            <tr v-for="index">
                              <td>
                                <div >

                                  <label class="form-control-label">消费项目：</label>
                                  <el-select v-model="service.serviceName" :disabled="load">
                                    <el-option
                                            v-for="service in services"
                                            :value="service.serviceName"
                                    >
                                      <a @click="setservice(service.serviceId,service.serviceName,service.servicePrice,service.servicePercent);" style="width:100%">{{service.serviceName}}</a>
                                    </el-option>
                                  </el-select>

                                </div>
                              </td>
                            </tr>
                          </table>

                          <table class="table">
                            <tr v-if="servicechosed.length!=0">
                              <th>服务ID</th>
                              <th>服务名称</th>
                              <th>价格(元)</th>
                              <th>操作</th>
                            </tr>

                            <tr v-for="item in servicechosed">
                              <td>{{item.serviceId}}</td>
                              <td>{{item.serviceName}}</td>
                              <td>{{item.servicePrice}}</td>
                              <td>
                                <el-button type="button" @click="deleteService(item)">删除</el-button>
                              </td>

                            </tr>

                            </table>
                          <div>
                            <label>其他项目金额(元)：</label>
                            <el-input v-model="itemmoney" :disabled="load">

                            </el-input>
                            <el-button :loading="load" @click="addService()">
                                添加
                            </el-button>
                          </div>
                          <div><label>总计(元)：</label>
                            <el-input v-model="totlemoney" :disabled="true"></el-input>
                            <el-button :loading="load" @click="deal()">
                              支付
                            </el-button>
                          </div>

                      </form>
                    </div>
                  </div>
                </div>
            </div>


                <div class="col-lg-7">
                  <div class="card">
                    <div class="card-header d-flex align-items-center">
                      <h3 class="h4">交易记录</h3>
                    </div>
                    <div class="card-body">
                      <form class="form-horizontal">
                        <div class="form-group row">

                          <div class="col-sm-12">

                              <el-table
                                      :data="costs.slice((currentPage1-1)*pagesize1,currentPage1*pagesize1)"
                                      style="width: 100%"
                                      :default-sort = "{prop: 'cost_date', order: 'descending'}"
                              >
                                <el-table-column
                                        prop="cost_date"
                                        label="日期"
                                        sortable
                                        width="170%">
                                </el-table-column>
                                <el-table-column
                                        prop="client_name"
                                        label="姓名"
                                        width="120%">

                                </el-table-column>
                                <el-table-column
                                        prop="service_name"
                                        label="消费项目"
                                >
                                </el-table-column>
                                <el-table-column
                                        prop="cost_price"
                                        label="消费金额(元)"

                                        >
                                </el-table-column>
                                <el-table-column
                                        prop="cost_money"
                                        label="账户余额(元)"
                                        >
                                </el-table-column>
                              </el-table>

                               <el-pagination
                                       @size-change="handleSizeChange1"
                                       @current-change="handleCurrentChange1"
                                       :current-page="currentPage1"
                                       :page-sizes="[4, 8, 12, 16]"
                                       :page-size="pagesize1"
                                       layout="total, sizes, prev, pager, next, jumper"
                                       :total="costs.length">
                               </el-pagination>


                          </div>
                        </div>

                      </form>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header d-flex align-items-center">
                      <h3 class="h4">充值记录</h3>
                    </div>
                    <div class="card-body">
                      <form class="form-horizontal">
                        <div class="form-group row">

                          <div class="col-sm-12">
                            <template>
                              <el-table
                                      :data="recharges.slice((currentPage2-1)*pagesize2,currentPage2*pagesize2)"
                                      style="width: 100%"
                                      :default-sort = "{prop: 'recharge_date', order: 'descending'}"
                              >
                                <el-table-column
                                        prop="recharge_date"
                                        label="日期"
                                        sortable
                                        width="170%">
                                </el-table-column>

                                <el-table-column
                                        prop="recharge_price"
                                        label="充值金额(元)"

                                >
                                </el-table-column>
                                <el-table-column
                                        prop="recharge_money"
                                        label="账户余额(元)"
                                >
                                </el-table-column>
                              </el-table>


                              <el-pagination
                                      @size-change="handleSizeChange2"
                                      @current-change="handleCurrentChange2"
                                      :current-page="currentPage2"
                                      :page-sizes="[4, 8, 12, 16]"
                                      :page-size="pagesize2"
                                      layout="total, sizes, prev, pager, next, jumper"
                                      :total="recharges.length">
                              </el-pagination>


                            </template>
                          </div>
                        </div>

                      </form>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header d-flex align-items-center">
                      <h3 class="h4">提现记录</h3>
                    </div>
                    <div class="card-body">
                      <form class="form-horizontal">
                        <div class="form-group row">

                          <div class="col-sm-12">
                            <template>
                              <el-table
                                      :data="drawings.slice((currentPage3-1)*pagesize3,currentPage3*pagesize3)"
                                      style="width: 100%"
                                      :default-sort = "{prop: 'drawings_date', order: 'descending'}"
                              >
                                <el-table-column
                                        prop="drawings_date"
                                        label="日期"
                                        sortable
                                        width="180">

                                </el-table-column>
                                <el-table-column
                                        prop="client_name"
                                        label="姓名"
                                        width="180">

                                </el-table-column>
                                <el-table-column
                                        prop="drawings_price"
                                        label="提取金额"
                                        sortable
                                >
                                </el-table-column>
                              </el-table>

                              <el-pagination
                                      @size-change="handleSizeChange3"
                                      @current-change="handleCurrentChange3"
                                      :current-page="currentPage3"
                                      :page-sizes="[4, 8, 12, 16]"
                                      :page-size="pagesize3"
                                      layout="total, sizes, prev, pager, next, jumper"
                                      :total="drawings.length">
                              </el-pagination>

                            </template>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
          	    </div>




		          </div>
    		    </div>
     			</section>
     			
          <!-- Page Footer-->
          <footer class="main-footer">
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-6">
                  <p>Your company &copy; 2019-2020</p>
                </div>
                <div class="col-sm-6 text-right">
                  <p>Design by Star sisiter and brother &nbsp;&nbsp;&nbsp;<a href="#" title="贺星QQ：2830756505； 贺明QQ：957039243。">联系我们</a></p>
                </div>
              </div>
            </div>
          </footer>
        </div>
      </div>      
    </div>
    
    
  <!-- JavaScript files-->
  <script>

    var v1 = new Vue({
      el: '#app',
      data:{
        //myUrl:"http://localhost:8080/spring9",
        myUrl:"/spring",
        load:true,
        flag:false,
        xuanze:{id:0,name:""},
        index:5,
        flag1:0,

        cardCode:"",
        card:"",

        service:{
          serviceId:0,
          serviceName:"",
          servicePrice:""
        },
        services:[],
        servicechosed:[],
        servicePercent:0.1,

        recharges:[],
        rechargePrice:0,
        costs:[],
        drawings:[],
        drawingsPrice:0,

        itemmoney:[],
        totlemoney:0,

        currentPage1:1,
        pagesize1:4,
        currentPage2:1,
        pagesize2:4,
        currentPage3:1,
        pagesize3:4,


        money1:[1,2,3,4],

        clients:[]
      },
      methods: {
        getService:function(){
          axios.get(this.myUrl+"/service/findAll")
                  .then(response => {
                    this.services = response.data;
                  })
                  .catch(error => {
                    console.log(error);
         });
        },
        check:function(){
          if(this.cardCode.length==1) {
            axios.get(this.myUrl + "/card/findById", {
              params: {
                id: this.cardCode
              }
            })
                    .then(response => {
                      this.card = response.data;
                      if (this.card.length != 0) {
                        this.load = false;
                        this.flag=true;
                      }
                      else{
                        this.$alert("查询不到卡号信息");
                      }
                    })
                    .catch(error => {
                      console.log(error);
                    });
          }
          else if (this.cardCode.length==11){
            axios.get(this.myUrl + "/card/findByHolderPhoneDetail", {
              params: {
                id: this.cardCode
              }
            })
                    .then(response => {
                      this.card = response.data;
                      if (this.card.length != 0) {
                        this.load = false;
                        this.flag=true;
                      }
                    })
                    .catch(error => {
                      console.log(error);
                    });
          }
          if(this.flag==true){
              axios.get(this.myUrl+"/recharge/findByCardIdDetail",{
                    params:{
                      id:this.cardCode
                    }
                 })
                    .then(response => {
                      this.recharges = response.data;
                    })
                    .catch(error => {
                      console.log(error);
                    });
            axios.get(this.myUrl+"/cost/findByCardIdDetail",{
                  params:{
                    id:this.cardCode
                  }
                })
                    .then(response => {
                      this.costs = response.data;
                    })
                    .catch(error => {
                      console.log(error);
                    });
            axios.get(this.myUrl+"/drawings/findByCardIdDetail",{
                  params:{
                    id:this.cardCode
                  }
                })
                    .then(response => {
                      this.drawings= response.data;
                    })
                    .catch(error => {
                      console.log(error);
                    });
            axios.get(this.myUrl+"/card/findByIdDetail",{
              params:{
                id:this.cardCode
              }
            })
                    .then(response => {
                      this.clients= response.data;
                    })
                    .catch(error => {
                      console.log(error);
                    });

          }
        },

        recharge:function(){
          axios({
            method: 'post',
            url: this.myUrl + "/workSpace/recharge",
            data: {
              cardId: this.cardCode,
              rechargePrice: this.rechargePrice
            }
          })
                  .then(response => {
                    if (response.status === 200) {
                      this.flag1+=1;
                      this.$message({
                        type: 'success',
                        showClose: true,
                        message: '充值成功'
                      });
                    } else {
                      console.log(response);
                      this.$alert("充值失败!");
                    }
                  })
                  .catch(error => {
                    console.log(error);
                    this.$alert(error);
                  });
        },

        drawings1:function(){
          if(this.card.cardPoint>=this.drawingsPrice) {
            axios({
              method: 'post',
              url: this.myUrl + "/workSpace/drawings",
              data: {
                cardId: this.cardCode,
                drawingsPrice: this.drawingsPrice
              }
            })
                    .then(response => {

                      if (response.status === 200) {
                        this.flag1 += 1;
                        this.$message({
                          type: 'success',
                          showClose: true,
                          message: '充值成功'
                        });
                      } else {
                        console.log(response);
                        this.$alert("充值失败!");
                      }
                    })
                    .catch(error => {
                      console.log(error);
                      this.$alert(error);
                    });
          }
          else{
            this.$alert("提现金额不得大于积分数！");
          }
        },

        deal:function(){

          if(confirm("确认支付？")) {

            if (this.xuanze.id != 0) {
                if(this.card.cardMoney-this.totlemoney>=0){

                axios({
                  method: 'post',
                  url: this.myUrl + "/workSpace/cost",
                  data: {
                    cardId: this.cardCode,
                    clientId: this.xuanze.id,
                    serviceList: this.servicechosed
                  }
                })
                        .then(response => {
                          if (response.status === 200) {
                            this.flag1+=1;
                            this.$message({
                              type: 'success',
                              showClose: true,
                              message: '支付成功'
                            });
                          } else {
                            console.log(response);
                            this.$alert("支付失败!");
                          }
                        })
                        .catch(error => {
                          console.log(error);
                          this.$alert(error);
                        });
              }
                else{
                  this.$alert("余额不足");
                }
            }
            else{
              this.$alert("请选择消费者");
            }
          }


        },


        deleteService:function(service){

          var index=this.servicechosed.indexOf(service);
          if(index>-1){
            this.servicechosed.splice(index, 1);
          }
        },

        deleteclient:function(client){
          if(confirm("确认删除？")){
            axios({
              method: 'post',
              url: this.myUrl+"/cardClient/deleteById"+"?"+"cardId="+this.cardCode+"&"+"clientId="+client.client_id
            })
                    .then(response => {
                      if (response.status===200){
                        this.$message({
                          type: 'success',
                          showClose:true,
                          message: '删除成功'
                        });
                      }else{
                        console.log(response);
                        this.$alert("无法删除!");
                      }
                    })
                    .catch(error => {
                      console.log(error);
                      this.$alert(error);
                    });
          }
        },

        addService:function(){
          var a={serviceId:1,serviceName:"其他",servicePrice:this.itemmoney,servicePercent:this.servicePercent};
          this.servicechosed.push(a);
        },

        handleSizeChange1: function (size) {
          this.pagesize1 = size;
        },
        handleCurrentChange1: function(currentPage){
          this.currentPage1 = currentPage;
        },
        handleSizeChange2: function (size) {
          this.pagesize2 = size;
        },
        handleCurrentChange2: function(currentPage){
          this.currentPage2 = currentPage;
        },
        handleSizeChange3: function (size) {
          this.pagesize3 = size;
        },
        handleCurrentChange3: function(currentPage){
          this.currentPage3 = currentPage;
        },

        setservice:function(serviceId,serviceName,servicePrice,servicePercent){
          var a={serviceId:serviceId,serviceName:serviceName,servicePrice:servicePrice,servicePercent:servicePercent};
            this.servicechosed.push(a);
        },


        bangding:function(id,name){
          this.xuanze.id=id;
          this.xuanze.name=name;
        },
        
        
        
        
        
        
        
        //================================不要删除==================================
 	      	//工具栏(侧栏)响应函数
 	      	select_one:function(){
 	      		var t_code=window.location.href.split("=")[1];
 	      		window.location.href="work.html"+"?"+"code="+t_code;
 	      	},
 	      	select_two:function(){
 	      		var t_code=window.location.href.split("=")[1];
 	      		window.location.href="card_info.html"+"?"+"code="+t_code;
 	      	},
 	      	select_three:function(){
 	      		var t_code=window.location.href.split("=")[1];
 	      		window.location.href="client_info.html"+"?"+"code="+t_code;
 	      	},
 	      	select_four:function(){
 	      		var t_code=window.location.href.split("=")[1];
 	      		window.location.href="image_info.html"+"?"+"code="+t_code;
 	      	},
 	      	select_five:function(){
 	      		var t_code=window.location.href.split("=")[1];
 	      		window.location.href="analyse.html"+"?"+"code="+t_code;
 	      	},
 	      	select_six:function(){
 	      		var t_code=window.location.href.split("=")[1];
 	      		window.location.href="set.html"+"?"+"code="+t_code;
 	      	}
        

        
      },
      watch:{
        servicechosed:{
          handler(){
            var i;
            this.totlemoney=0;
            for(i=0;i<this.servicechosed.length;i++)
            {

              this.totlemoney+=Number(this.servicechosed[i].servicePrice);
            }
          },
          deep: true,
          immediate: true
        },
        flag1:{
          handler(){

            this.check();
          },
          immediate: true
        }

      }

    });
    v1.getService();

  </script>
  </body>

</html>